<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Test StT9CU Bulan Juli 2025</title>

    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Memuat PapaParse untuk membaca data dari Google Sheet -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <!-- Konfigurasi Font dan Style Tambahan -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        /* Style untuk feedback jawaban */
        .correct {
            background-color: #10B981 !important; /* Hijau */
            color: white !important;
            border-color: #059669 !important;
        }
        .incorrect {
            background-color: #EF4444 !important; /* Merah */
            color: white !important;
            border-color: #DC2626 !important;
        }
        /* Efek transisi untuk tombol */
        .option-btn {
            transition: all 0.2s ease-in-out;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        /* Style untuk tombol yang dinonaktifkan */
        .btn-disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        /* Custom styles for ST9CU logo */
        .st9cu-logo {
            font-family: sans-serif; /* Fallback font */
            font-weight: 900;
            font-size: 4rem; /* Adjust as needed */
            line-height: 1;
            color: #333;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }
        .st9cu-logo span {
            color: #FFC107; /* Orange/Yellow color for '9' - similar to image */
        }
        .st9cu-logo-small {
            font-family: sans-serif;
            font-weight: 900;
            font-size: 2rem; /* Smaller size for quiz screen */
            line-height: 1;
            color: #333;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
            margin-bottom: 1rem;
            text-align: center; /* Center the logo */
        }
        .st9cu-logo-small span {
            color: #FFC107; /* Orange/Yellow color for '9' */
        }
        .explanation-box {
            background-color: #e0f2f7; /* Light blue background */
            border-left: 4px solid #00bcd4; /* Cyan border */
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.5rem;
            color: #006064; /* Dark cyan text */
            font-size: 0.9rem;
            text-align: left;
        }
        /* Styles for result messages */
        .success-message {
            background-color: #D1FAE5; /* Light green */
            color: #065F46; /* Darker green */
            border-left: 4px solid #10B981;
        }
        .fail-message {
            background-color: #FEE2E2; /* Light red */
            color: #991B1B; /* Darker red */
            border-left: 4px solid #EF4444;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-2xl mx-auto">

        <!-- 1. Tampilan Awal / Loading -->
        <div id="start-screen" class="bg-white p-8 rounded-2xl shadow-lg text-center">
            <!-- Logo ST9CU -->
            <div class="st9cu-logo mb-4">ST<span>9</span>CU</div>
            <h1 id="quiz-title" class="text-3xl font-bold text-gray-800 mb-4">Post Test StT9CU Bulan Juli 2025</h1>
            <p id="quiz-description" class="text-gray-600 mb-4">waktunya ST9CU, sdm tiap hari, eksis dengan content Update, daftar dulu yuk!</p>
            
            <!-- Informasi Penting -->
            <div id="important-info" class="bg-blue-50 p-4 rounded-lg mb-6 text-left text-blue-800 border-l-4 border-blue-400">
                <h3 class="font-semibold text-lg mb-2">Informasi Penting</h3>
                <p class="text-sm">Seluruh jawaban kuis akan dikumpulkan menjadi dasar pembuatan Sertifikat Kompetensi SDM setiap akhir bulan.</p>
            </div>

            <!-- Petunjuk Kuis -->
            <div id="quiz-explanation" class="bg-gray-100 p-4 rounded-lg mb-6 text-left text-gray-700">
                <h3 class="font-semibold text-lg mb-2">Petunjuk Kuis:</h3>
                <ul class="list-disc list-inside text-sm">
                    <li>Kuis ini terdiri dari **20 pertanyaan** pilihan ganda.</li>
                    <li>Setiap jawaban benar bernilai **5 poin**.</li>
                    <li>Nilai kelulusan adalah menjawab benar **15 soal** atau mencapai nilai **75 poin**.</li>
                    <li>Peserta yang lulus berhak mendapatkan sertifikat ST9CU bulan Juli 2025.</li>
                    <li>Harap mengisi Nama Lengkap dan NIP dengan benar karena akan digunakan untuk sertifikat Anda.</li>
                    <li>Pilih jawaban terbaik untuk setiap pertanyaan.</li>
                </ul>
            </div>

            <!-- Input Nama dan NIP -->
            <div class="mb-6 text-left">
                <label for="user-name" class="block text-gray-700 text-sm font-bold mb-2">Nama Lengkap:</label>
                <input type="text" id="user-name" placeholder="Masukkan nama lengkap Anda" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>
            <div class="mb-6 text-left">
                <label for="user-nip" class="block text-gray-700 text-sm font-bold mb-2">NIP:</label>
                <input type="text" id="user-nip" placeholder="Masukkan NIP Anda" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>
            <div class="mb-8 text-left">
                <label for="user-satker" class="block text-gray-700 text-sm font-bold mb-2">Satker/Tim Kerja/Unit Kerja:</label>
                <input type="text" id="user-satker" placeholder="Masukkan satker/tim kerja Anda" class="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400">
            </div>

            <div id="loading-state">
                <p class="text-blue-600 font-semibold">Memuat soal dari Google Sheet...</p>
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mt-4"></div>
            </div>
            <!-- Pesan error/informasi akan ditampilkan di sini -->
            <div id="message-box" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
                <strong class="font-bold">Perhatian!</strong>
                <span id="message-text" class="block sm:inline"></span>
            </div>
            <button id="start-btn" class="hidden bg-green-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-green-700 transition-transform transform hover:scale-105 w-full md:w-auto flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2">
                    <path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.566 0 3.278L7.28 20.991c-1.25.687-2.779-.217-2.779-1.643V5.653Z" clip-rule="evenodd" />
                </svg>
                Mulai Kuis
            </button>
        </div>

        <!-- 2. Tampilan Kuis -->
        <div id="quiz-screen" class="hidden bg-white p-8 rounded-2xl shadow-lg">
            <!-- Logo ST9CU di dalam kuis screen -->
            <div class="st9cu-logo-small mb-4">ST<span>9</span>CU</div>
            <div class="flex justify-between items-center mb-6">
                <p id="progress-text" class="text-sm font-medium text-gray-500">Soal 1 dari 10</p>
                <p id="score-text" class="text-sm font-medium text-green-600">Skor: 0</p>
            </div>
            <div class="bg-gray-50 p-6 rounded-lg mb-6">
                <p id="question-text" class="text-xl font-semibold text-gray-800 text-center">Ini adalah placeholder untuk pertanyaan kuis yang akan dimuat dari Google Sheet.</p>
            </div>
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Opsi jawaban akan di-generate oleh JavaScript -->
            </div>
            <!-- Kotak penjelasan jawaban -->
            <div id="explanation-box" class="explanation-box hidden">
                <h4 class="font-bold mb-1">Penjelasan:</h4>
                <p id="explanation-text"></p>
            </div>
        </div>

        <!-- 3. Tampilan Hasil Akhir -->
        <div id="result-screen" class="hidden bg-white p-8 rounded-2xl shadow-lg text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Kuis Selesai!</h2>
            <p class="text-gray-600 mb-6">Berikut adalah hasil akhir Anda:</p>
            <div id="score-display-box" class="p-6 rounded-xl mb-8">
                <p class="text-lg text-blue-800">Skor Akhir Anda</p>
                <p id="final-score" class="text-6xl font-bold text-blue-600 my-2">100</p>
                <p id="score-summary" class="text-blue-800">Anda menjawab 10 dari 10 soal dengan benar!</p>
            </div>
            <!-- Pesan hasil kuis (lulus/tidak lulus) -->
            <div id="result-message-box" class="p-4 rounded-lg mb-6 text-center">
                <p id="result-message" class="text-lg font-semibold"></p>
                <p id="result-emoji" class="text-4xl mt-2"></p>
                <!-- Trophy icon for success -->
                <svg id="trophy-icon" class="hidden w-20 h-20 mx-auto mt-4 text-yellow-500" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h4l1 3h4l1-3h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/>
                </svg>
            </div>
            <!-- Tampilkan Nama, NIP, dan Satker di hasil akhir -->
            <p id="final-user-info" class="text-gray-700 mb-4"></p>
            <button id="restart-btn" class="bg-gray-700 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-gray-800 transition-transform transform hover:scale-105 w-full md:w-auto">
                Ulangi Kuis
            </button>
        </div>

    </div>

    <script>
        // --- URL Google Sheet Anda ---
        // Pastikan sheet Anda dipublikasikan ke web sebagai CSV
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSjCkpLfaIDhPZIKs-HCaTbreC_REydA0OLSppwRJEgAs0KKaekZj7eo-81NK4qUXEtWSQKgn1SwWyW/pub?gid=0&single=true&output=csv';

        // --- Elemen-elemen UI ---
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');

        const loadingState = document.getElementById('loading-state');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');

        const progressText = document.getElementById('progress-text');
        const scoreText = document.getElementById('score-text');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');

        const finalScore = document.getElementById('final-score');
        const scoreSummary = document.getElementById('score-summary');
        const finalUserInfo = document.getElementById('final-user-info'); // Elemen untuk menampilkan info pengguna di hasil akhir

        // Elemen untuk menampilkan pesan di dalam aplikasi (menggantikan alert)
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');

        // Input fields for user info
        const userNameInput = document.getElementById('user-name');
        const userNipInput = document.getElementById('user-nip');
        const userSatkerInput = document.getElementById('user-satker'); // New input for Satker

        // Explanation box elements
        const explanationBox = document.getElementById('explanation-box');
        const explanationText = document.getElementById('explanation-text');

        // Result message elements
        const scoreDisplayBox = document.getElementById('score-display-box');
        const resultMessageBox = document.getElementById('result-message-box');
        const resultMessage = document.getElementById('result-message');
        const resultEmoji = document.getElementById('result-emoji');
        const trophyIcon = document.getElementById('trophy-icon');

        // --- Variabel State Kuis ---
        let allQuestions = []; // Array untuk menyimpan semua soal yang dimuat
        let currentQuestionIndex = 0; // Indeks soal saat ini
        let score = 0; // Skor pengguna (dalam poin)
        let userName = ''; // Nama pengguna
        let userNip = ''; // NIP pengguna
        let userSatker = ''; // Satker pengguna
        const POINTS_PER_QUESTION = 5; // Nilai poin untuk setiap soal yang benar
        const PASSING_SCORE = 75; // Nilai minimum untuk lulus kuis

        // Set untuk melacak kombinasi nama-NIP yang sudah menyelesaikan kuis dalam sesi ini
        // Catatan: Ini hanya akan berfungsi selama sesi browser aktif. Jika browser ditutup, data ini akan hilang.
        const completedUsers = new Set();

        // Daftar NIP yang valid
        // Nama Lengkap bebas diisi, tetapi NIP harus ada dalam daftar ini
        const VALID_NIPS = new Set([
            "197609271999011001", "196801191993022001", "198701042009022004", "197212121994012001",
            "198001292005021002", "196305051991021001", "198104262003122006", "197006251998031001",
            "197605021997121001", "197402031996121001", "197311221995121002", "198103292006021001",
            "197910072000121004", "198304162008011009", "197701261999011001", "198210212004122001",
            "198211012004121003", "198407062008012017", "197905122002122003", "198306012006022001",
            "196809091994012001", "197707242000122002", "198510202007012002", "198408232008012009",
            "198511152008012003", "198512072008012004", "198705242009022007", "197912262002121004",
            "198604232009021003", "198510242009022006", "197409191993011001", "196912171994011001",
            "197806282000121003", "197409262002122002", "197901222002122005", "197711142000031001",
            "197011101992031005", "198407102007011003", "199402232016021001", "197307281994122001",
            "198302252006041003", "198710242009122002", "198807062010121007", "197012271990031002",
            "198108092004121001", "196906231989032001", "197703111998031002", "198707022013111001",
            "198608302011012027", "199212272014122001", "199406152016021001", "198006052005022001",
            "199209032014122002", "198601072010031002", "198612092009121003", "198606192009022004",
            "197407311993011001", "199809212021042001", "199510222018021001", "199504292019122001",
            "199509242018021001", "198802192010031001", "199408232019032001", "197909152006042026",
            "199607132019032001", "199312172017011001", "199210272019031001", "198810272011012013",
            "199801042019121001", "199412162017012002", "199703312019122002", "199906232022011001",
            "199811182022012002", "200203152023022001", "199302072014121001", "200107042024122003",
            "200109132024121002", "197308101994011001", "199007132012112001", "197006252002121003",
            "197503301996031002", "197606122002121010", "198405152007011001", "199811042023022001",
            "200101082019122001", "199809022019122001", "196711251994022001", "197409241994032001",
            "197609021999012001", "198311102005022001", "197804082005022002", "198404272011011010",
            "198208032005022002", "198806102011012013", "198409292011011015", "198604182011011011",
            "197801301998031001", "197611122008012014", "197201271998032012", "199506132017012001",
            "198903082012111001", "198411182009022008", "197801282005022003", "198712222008012001",
            "199405142017012001", "199606302019121001", "198102022005021002", "199311062016022002",
            "199408272017012001", "199712252019121001", "198802112010031001", "198410262011012013",
            "198902202011012009", "198506272009022011", "198712292010032001", "198910122023212022",
            "199003062012122001", "198402092007011001", "198611132022032001", "199901092022012001",
            "199401122025061005", "199605282025061004", "200208282025062002", "200305102025062001",
            "197407081997121001", "197912022009011010", "199112102014121001", "199301192014121001",
            "198308292011011014", "199006092014101001", "199306152016021001", "199108222014121001",
            "199201212014121001", "198604302010032001", "199312092016022002", "197906071999031001",
            "198412312011011020", "198406232011012016", "198312252011011016", "198712292011012018",
            "199304102016022001", "199401102022032015", "198903252022032003", "200101202023021003",
            "200208282023101005", "200008122023101001", "199112042024211003", "200112032023022002",
            "200204272024121004", "198104132011011005", "197508182007012002", "198602152008011003",
            "197505021996121001", "198606142009021008", "197910252002121004", "199308182016021001",
            "198511292011011007", "199403162017012001", "199204062014122001", "199610242019012001",
            "199506082018022001", "197007301994011001", "197707312007012002", "197508282006041017",
            "198412182006042009", "199801092019122002", "199611062019122001", "200104112023101003",
            "200201122023102001", "199806052023021001", "200007182023022003", "197503232007011004",
            "199907282022032008", "199002052022032008", "200107312023021001", "200111112023022001",
            "198011132005022001", "198105272007011001", "198811172011011008", "199907052025062006",
            "197510032007012022", "198111102003121004", "197404121996031001", "198408152007011001",
            "197207111995121001", "197309051993011001", "198712302010122005", "199404162016021001",
            "199003192019032002", "199210172016022001", "199409052019011001", "199604272019011001",
            "199404302017012001", "199912112023021003", "197704052006042003", "200012082023101004",
            "200201242023101004", "199902022022011001", "197607072007011004", "198206012024211001",
            "200001032024121001", "198710222008011001", "198004262003121003", "198004192009021004",
            "198408052003121002", "199407082019032002", "197807212011011006", "198504102008012003",
            "199508242019012002", "199705102019122002", "199812292023021001", "199912042023021004",
            "199710292022012001", "198503072006041004", "198303062011011012", "199901272022012002",
            "200106292023101002", "199712242022032015", "199812222022011003", "200011252024121002",
            "200303132024122001", "198509042011012010", "198609082011011008", "196803281994021001",
            "197804091999031001", "196708081989031007", "198204082007011001", "198012112007012001",
            "197212232006041009", "196909091994011002", "197406061998032001", "198608022009021002",
            "197311011994011001", "198603292011011014", "198807102010122005", "199602072019122001",
            "199404162016021002", "199511042019011001", "198409172007012001", "199509242022032016",
            "197512182006041012", "200004072023021005", "200009022022012002", "199401292019032001",
            "200104282023022006", "199711232024211001", "199807242022032019", "198208172004122001",
            "197307122007012003", "197705152007012003", "198412092003122002", "197310311995121001",
            "198310122003121005", "197802242005021002", "198506202007011001", "197908092006041010",
            "198303212007011001", "198005112007011001", "198101012009011022", "197401221994011001",
            "198208112006042004", "199006062012112001", "199101082014102001", "198405082007012005",
            "198802122012122001", "199801092019122001", "198706022010032001", "199702192019031001",
            "200005282022012007", "199608042019012001", "199705282019121001", "200005252023022003",
            "197504142006041019", "199909042022012001", "199511292022031012", "198607282005022001",
            "198506112024212003", "199411082022032012", "198210302011011011", "198007172005022001",
            "197201061994121001", "196911301991011001", "197612211998031003", "197403071994011001",
            "198103152003122004", "197412312006041089", "198506262011012023", "197709112006042026",
            "199104062014102001", "198704252011012014", "197811022003122003", "197909202007101002",
            "198812042011012016", "198706032009021002", "199006232013112002", "200006112023022002",
            "199905162022012004", "199710212022011001", "199804032021041001", "200107092022012001",
            "198006292007011001", "200206232024122003", "198511162003121002", "197607011999121001",
            "197702232000121003", "198309282008012006", "198604162010032002", "197101311992031002",
            "198508112008011002", "198410122011012016", "197908172006041006", "199011102013112001",
            "199407092016021001", "198708282011012023", "199804162019121001", "199403032017011001",
            "198607032011011011", "197310192005021001", "199111032014122001", "198709302011012019",
            "198712152008012001", "198207222011011008", "198806302011012013", "199209062014121001",
            "198706052011011012", "198912222012121001", "200002082022012004", "199306302022032013",
            "198712242011011003", "199912232023021002", "198810182022032003", "197205101994011002",
            "198202022007011001", "198512032008012003", "197706252007011004", "196710041994011001",
            "198305042007011001", "198901262012111001", "198205262009012007", "198603142009111001",
            "197704052007011002", "198207092007011009", "198403082008011009", "197708051999122001",
            "198103122006021001", "198310252006021001", "198005272003121004", "198606072009022004",
            "197403181993012001", "199107022013112001", "198702282011012018", "199112012014102001",
            "199305122016022001", "198612122011012024", "199411182017012001", "199605162019012002",
            "199503282018022001", "199702232019032001", "199403092016021001", "196911061989031002",
            "199301062014121001", "197203131993011001", "198601292005022001", "199801292021042001",
            "197401112005021002", "198402132006041008", "198610142005021001", "199905052022032015",
            "199610172022032017", "198703092009121003", "198212312006041007", "197405232007011005",
            "198508152006042001", "197701212003121006", "198408172008012004", "198701192008012001",
            "197111141993031001", "197410241994011001", "198403122011011014", "197705242006042002",
            "198310012006041009", "199007012013112001", "197607061999032001", "199701062019121002",
            "198604022011012022", "199604112019031001", "199707262019122001", "199902012022012003",
            "200107032023102003", "199809062022011001", "198811012022031004", "199807012023021001",
            "198705282006042002", "199506062022032021", "199002092024211001", "200110262023021005",
            "197708162011011004", "198001312006041005", "197805102000121003", "198703292022032003",
            "198804022022032004", "198602102009021002", "198401312006022001", "197507071994011002",
            "196905021991021001", "199006042013111001", "198210042010031001", "199212302014121001",
            "199012262014102001", "198103202003122001", "199307022018021001", "199610072019012002",
            "197211171993011002", "199310222019032001", "198903182012122001", "198811232012122003",
            "199702062022032016", "197608141996031001", "199712172022032016", "199107112014102001",
            "196801281994031002", "198701212009022003", "198808102011011006", "197312281993011001",
            "196812101991011002", "197101191992012001", "197708271999031002", "198412062005021001",
            "197509272005021001", "198504062009021005", "198407082007011002", "196803291994011001",
            "197507071994011001", "197606261998031002", "198707012011011006", "198404162011012014",
            "198208122006042026", "197303261994121001", "197203121994011001", "196908191994011001",
            "196909211990031004", "198105072005021001", "197807142002122003", "197707282002122003",
            "197807262002122003", "199608182018022001", "198104162002121002", "198908122014101001",
            "197807032003121001", "198204112003122001", "198903262011012014", "198705222006041002",
            "199205302014122001", "198012112005021005", "199104192012121002", "199902062021042001",
            "198511032010031001", "198609202010031001", "198201312007011001", "199602262019012001",
            "198709022011011009", "197108212007011002", "199907112022032009", "199811062022032017",
            "198303122006021002", "197906182005022003", "197008281991011001", "198704222011012016",
            "198404172011012018", "198001112007012003", "198304192006021001", "196812091992031001",
            "198507202010031002", "198506262007012001", "197712142005021002", "197504222007011002",
            "198507192009022006", "197604082002122003", "198609012009022008", "198012292005021001",
            "197305052002121004", "198712092010122004", "197905032000122002", "196803101989031004",
            "198801022011012015", "199203082014122001", "198911222012112001", "198508302011011011",
            "198106232011011008", "197409192003121001", "198301262011011009", "198312232011011008",
            "199410112017012001", "199108312014122001", "198411242003122001", "198603292011011015",
            "198704252011011014", "198211042011011012", "200002152022012005", "197210131992031002",
            "199112032022031005", "198901162012112001", "198705122008012001", "198902142011011005",
            "197410232002121001", "198208312006041011", "199303112016021001", "197808282011011008",
            "199310092016021001", "199209162014122001", "198112092011011005", "198502032011011013",
            "199803092021041001", "199902162022011002", "199909302022011001", "199307312022031008",
            "200009272023022002", "200012032023102001", "200007012023101004", "198511122008011002",
            "198811082011011004", "199606122022032026", "198203042006041001", "198702102010031002",
            "197205131993121001", "198112292003122003", "197712062007011002", "198504132007011001",
            "198804022009122002", "198701202009122002", "199709272019121001", "199705012019122001",
            "200012022023102001", "200105012023102003", "200104222023022003", "199712222023022001",
            "199909272022012005", "197407011994031002", "197509272007011006", "200107092023022003",
            "199607112018022001", "200202162024121005", "198802252011012022", "197405281994011001",
            "198605022006042001", "198508132010031004", "197807242006041003", "198512082005022001",
            "197204051994121001", "198407112008011003", "198911172013112001", "198303272011011010",
            "199801112019122002", "199606252018021001", "199605152019011002", "199906092022012004",
            "198503172009011006", "199909172022012003", "199810262022012001", "199806162019122001",
            "199803052023022001", "200006132023101002", "200006082023022002", "200011122023101001",
            "199909192022031008", "198604072009021005", "198309022011011008", "199601282022032011",
            "198209012006022001", "198111122011011012", "198605112011011008", "198304102011011013",
            "198509122008012005", "198406302009011003", "198612182012121001", "198503182012122002",
            "196901101990031004", "199602142019031001", "199701222019122001", "199204152014122001",
            "199402092017012001", "199709172019122003", "200104182023102001", "199304172022032012",
            "199911222022012003", "200010162023021002", "199706162023021001", "200202172023021001",
            "197407082002121003", "198706282012121001", "200102232025062004", "197301051994121001",
            "197603201997121001", "197205271992031004", "198810262010121004", "198804032010032004",
            "198605312009121005", "198412262008012003", "197711262002121004", "198704102009121002",
            "199006142013112001", "198206132011012013", "197001011989031001", "198408312005022002",
            "198706082015031002", "199009252012122002", "198310132003121004", "199305262016022001",
            "198408312011012011", "199507032019031001", "198905232012121002", "198211302011011008",
            "199612162019122001", "197207272007011006", "198809162008011001", "198811172010031001",
            "199409142024212007", "196802251989032004", "198403032006042003", "198508012005022001",
            "197403011994022001", "197307202007011002", "197511181999012001", "198603222008012002",
            "197406182003121001", "199104162014121001", "198612212009122002", "199101192013111001",
            "198007132011011006", "198201032005021001", "198809292012122001", "198911222019032001",
            "199006272019032001", "199501112019032001", "199702262019012001", "199705072019122002",
            "199402252016022001", "200012052023021002", "199212192022032011", "199906172022012003",
            "199304142024211007", "199905132022032008", "196711151989031003", "198411152007012001",
            "197210281993011002", "197005102002121008", "197308131994011001", "197004031994011001",
            "199612122019032001", "200106252023101001", "200105192023101004", "199012072022032007",
            "199808042021041001", "200004022023021004", "199812112022012002", "199905292023021001",
            "200108312023101003", "199001122024211005", "199905052022032017", "200201162023021002",
            "199010102013111001", "200111242024122002", "198009202005022001", "198608312009022008",
            "197403221997032001", "199005152013111001", "198907032012121003", "199807292021042001",
            "199510162019012001", "200012062023102003", "200009192023021001", "199512162019121001",
            "199501162022031007", "199808142019122001", "200107032023102004", "199110022024211002",
            "200112032023021002", "199908132022032007", "200202022024122001", "198505092009022006",
            "199204132025061002", "197502221997121001", "198710312011011010", "198902282012111001",
            "197910152005022002", "198302062011011005", "198108232005021001", "199511072018022002",
            "199511172019011001", "199605062019011001", "200008032023102002", "199809212023022002",
            "199901072023021001", "199801252023022001", "198301212009012006", "199302262024211021",
            "198403272006042018", "200009082022011004", "198402172008011005", "198903182011012005",
            "199002102013111001", "198304062011011011", "197408161994012001", "198108092011011010",
            "198610312006041001", "199211102014122001", "198807242011012011", "199801192019121002",
            "199607302019012001", "199907202022012003", "199908032022011002", "198703142019032001",
            "198606042006042001", "200009102023022001", "199201212024211003", "197001131992031002",
            "197809252005022007", "197810182001121003", "199304272014121001", "198808292011012013",
            "199310292016021001", "198508172010031002", "198207222011011007", "198611022008011002",
            "199908262023101002", "200003072022011004", "200101142023101003", "200106232023101002",
            "197102221991011001", "199310172016021001", "200111082024121003", "199206082014121001",
            "197201291993011002", "196902051994031009", "198009032006042004", "198809032010122005",
            "199307272019031001", "198407142011011015", "199304092019032002", "199801152019121001",
            "199908042022011004", "200009192022012005", "200106102023101006", "199905262022012001",
            "200109032023102002", "200201082023021001", "200204092024121001", "197102201994012001",
            "198402202006042005", "199107092025062001", "197409081994011001", "198607182009021001",
            "198009252005022003", "198001302002121004", "198903292011011004", "199201042014102001",
            "199206242014102001", "199603232019012002", "198709142011012016", "198707222008011001",
            "199909162022011002", "200008122023022005", "199710102022011001", "198108292011011008",
            "199805262019122001", "200101042023022002", "198704182011011010", "198508262009022015",
            "196901281992122001", "197704202011011005", "197805152003121006", "198304092004122001",
            "198408072008012006", "198911252014101001", "198107292005022001", "198610142009022008",
            "198510132011012015", "197009161991011001", "197504181996122001", "198702282012121001",
            "199202192014122001", "198801052010031001", "199106112014102001", "198705172011012022",
            "199208262016022001", "199603252019012003", "197306172006041014", "197909142005021002",
            "199210272014122001", "198706022011011008", "198405312007012002", "198409222024211001",
            "199911032019121001", "198702252011011008", "197102231992111001", "197206221994011001",
            "197308092005021001", "199002272012112001", "198308232006041006", "197308241994011001",
            "198806182010122004", "197705261999011001", "198708172009121001", "198212252006041003",
            "198909122012122002", "199204292014102001", "198411142011012017", "199706062019121001",
            "198203262002122003", "198807112011012011", "198609132019032001", "199908172022012004",
            "197212191994011001", "197905052005021005", "198108252008012014", "197206082007101001",
            "197201191992021002", "197104091991032003", "198011122002122001", "198304272007012002",
            "197408061994011001", "196802151994011001", "198403282007012003", "197710051999122002",
            "197901101999122001", "198311212010031002", "197203231994012001", "196903091991032002",
            "197506181994012001", "198712062011011013", "198501242010031001", "198311042008012007",
            "198606092008011002", "198301102005022002", "196712281994012001", "198810202010122004",
            "198609252009022005", "199102042014121001", "198303182005022003", "198812162010122005",
            "197205202006042001", "198507252011012021", "198909112012122004", "198907222011011002",
            "197702162001122001", "198201062003122002", "198707022011012016", "199602252019032002",
            "199606092018022001", "199305312016021001", "198712292011011004", "199305172016022001",
            "196906101994012001", "198710042006042002", "199112092013112001", "198205152011012008",
            "199902142019122001", "197410152005011006", "198505102010032002", "198301192006042004",
            "199305032023212034", "197102021998031004", "197908302008011012", "198305192006042003",
            "198303272005021002", "196803091994012001", "198205162006041012", "198409302010032002",
            "198809072011011011", "197108281994011001", "198704192009122001", "198612212009022002",
            "198306272005022002", "198107052002122002", "198412252009022017", "197009141991011001",
            "199312092016022001", "199008182013112001", "198906172012112001", "198905022013112001",
            "198604072006041002", "199308022019032001", "200103172024212002", "198503112003122001",
            "198512152009012008", "199909062019122001", "198305112011012015", "197409161994031002",
            "198508082005022002", "198012312005021003", "198511102008011003", "197807192005021001",
            "198212252006022001", "198705112012121002", "198006052006042036", "197306061994011001",
            "198009102003122002", "199311272016022001", "197307292006041002", "198205022006042007",
            "198205052011012012", "199503102018022002", "198411152011012016", "200107112023101005",
            "197906112005021001", "199903282022011003", "200007012023022004", "200012142023021006",
            "200110052023021003", "199303212024212004", "198302152007011007", "197912232001121003",
            "197310061994011001", "199307222016022001", "199304092016022001", "199102052014122001",
            "198603122011011014", "199702032019122001", "198208232001121001", "199305292016022002",
            "198810202011011003", "200004142023022002", "199706022022031013", "199901132023022001",
            "199309102016021001", "199309182016021001", "199505252018022001", "200206132024121004",
            "199210292014121001", "200204232025061002"
        ]);

        // --- Fungsi Utama ---

        /**
         * Fungsi pembantu untuk menormalisasi string (lowercase dan hapus spasi).
         * Berguna untuk perbandingan NIP yang konsisten.
         * @param {string} str - String yang akan dinormalisasi.
         * @returns {string} String yang sudah dinormalisasi.
         */
        function normalizeString(str) {
            return str.toLowerCase().replace(/\s+/g, '').trim(); // Menghapus semua spasi untuk NIP
        }

        /**
         * Menampilkan pesan di dalam kotak pesan UI.
         * @param {string} message - Pesan yang akan ditampilkan.
         * @param {string} type - Tipe pesan ('success', 'error', 'info'). Mengatur warna kotak pesan.
         */
        function showMessage(message, type = 'info') {
            messageText.innerText = message;
            messageBox.classList.remove('hidden');
            // Reset kelas warna
            messageBox.classList.remove('bg-red-100', 'border-red-400', 'text-red-700', 'bg-green-100', 'border-green-400', 'text-green-700', 'bg-blue-100', 'border-blue-400', 'text-blue-700');

            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
            } else { // default to info
                messageBox.classList.add('bg-blue-100', 'border-blue-400', 'text-blue-700');
            }
        }

        /**
         * Menyembunyikan kotak pesan.
         */
        function hideMessage() {
            messageBox.classList.add('hidden');
        }

        /**
         * Mengambil dan mem-parsing data CSV dari Google Sheet.
         * Data akan difilter untuk memastikan hanya soal yang valid yang digunakan.
         */
        function loadQuizData() {
            Papa.parse(GOOGLE_SHEET_URL, {
                download: true, // Mengizinkan PapaParse untuk mengunduh file dari URL
                header: true,   // Menggunakan baris pertama sebagai header (nama kolom)
                complete: (results) => {
                    // Peta data dari hasil PapaParse ke format yang diharapkan oleh kuis
                    allQuestions = results.data.map(row => {
                        return {
                            soal: row['Question (Pertanyaan)'] || '', // Memetakan kolom "Question (Pertanyaan)" ke 'soal'
                            a: row['OptionA (Opsi A)'] || '',       // Memetakan kolom "OptionA (Opsi A)" ke 'a'
                            b: row['OptionB (Opsi B)'] || '',       // Memetakan kolom "OptionB (Opsi B)" ke 'b'
                            c: row['OptionC (Opsi C)'] || '',       // Memetakan kolom "OptionC (Opsi C)" ke 'c'
                            d: row['OptionD (Opsi D)'] || '',       // Memetakan kolom "OptionD (Opsi D)" ke 'd'
                            kunci: row['CorrectAnswer (Jawaban Benar)'] || '', // Memetakan kolom "CorrectAnswer (Jawaban Benar)" ke 'kunci'
                            penjelasan: row['Explanation (Penjelasan)'] || '' // Memetakan kolom "Explanation (Penjelasan)" ke 'penjelasan'
                        };
                    }).filter(question =>
                        question.soal && question.soal.trim() !== '' &&
                        question.kunci && question.kunci.trim() !== ''
                    );
                    console.log('Soal berhasil dimuat:', allQuestions);

                    // Tampilkan tombol mulai setelah data siap
                    loadingState.classList.add('hidden');
                    if (allQuestions.length > 0) {
                        startBtn.classList.remove('hidden');
                        hideMessage(); // Sembunyikan pesan jika ada
                    } else {
                        // Tampilkan pesan jika tidak ada soal yang valid
                        showMessage('Tidak ada soal yang valid ditemukan di Google Sheet. Pastikan kolom "Question (Pertanyaan)" dan "CorrectAnswer (Jawaban Benar)" terisi.', 'error');
                    }
                },
                error: (error) => {
                    console.error('Gagal memuat data dari Google Sheet:', error);
                    document.getElementById('quiz-title').innerText = 'Error Memuat Data!';
                    document.getElementById('quiz-description').innerText = 'Tidak dapat memuat soal dari Google Sheet. Periksa kembali URL dan pastikan sheet sudah dipublikasikan ke web sebagai CSV.';
                    loadingState.classList.add('hidden');
                    // Tampilkan pesan error di kotak pesan
                    showMessage('Gagal memuat soal. Pastikan URL Google Sheet benar dan dipublikasikan sebagai CSV.', 'error');
                }
            });
        }

        /**
         * Memulai atau mereset kuis.
         * Mengatur ulang skor dan indeks pertanyaan, lalu menampilkan pertanyaan pertama.
         */
        function startQuiz() {
            // Ambil nilai nama, NIP, dan Satker
            userName = userNameInput.value.trim();
            userNip = userNipInput.value.trim();
            userSatker = userSatkerInput.value.trim();

            // Normalisasi NIP untuk perbandingan dengan daftar valid
            const normalizedUserNip = normalizeString(userNip);
            // Identifier untuk mencegah pengulangan tetap menggunakan nama dan NIP
            const userIdentifierForCompletion = `${normalizeString(userName)}-${normalizedUserNip}`;

            // Validasi input nama, NIP, dan Satker
            if (userName === '') {
                showMessage('Nama Lengkap harus diisi!', 'error');
                return;
            }
            if (userNip === '') {
                showMessage('NIP harus diisi!', 'error');
                return;
            }
            if (userSatker === '') {
                showMessage('Satker/Tim Kerja/Unit Kerja harus diisi!', 'error');
                return;
            }

            // Cek apakah NIP terdaftar dalam daftar VALID_NIPS
            if (!VALID_NIPS.has(normalizedUserNip)) {
                showMessage('NIP tidak terdaftar. Silakan periksa kembali atau hubungi administrator.', 'error');
                return;
            }

            // Cek apakah pengguna (berdasarkan Nama dan NIP) sudah menyelesaikan kuis dalam sesi ini
            if (completedUsers.has(userIdentifierForCompletion)) {
                showMessage('Anda sudah menyelesaikan kuis ini dengan Nama Lengkap dan NIP tersebut. Tidak bisa mengulang kembali.', 'info');
                return; // Hentikan fungsi jika sudah selesai
            }

            // Pengecekan untuk memastikan ada soal sebelum memulai kuis
            if (allQuestions.length === 0) {
                showMessage('Tidak ada soal yang valid untuk ditampilkan. Silakan muat ulang halaman atau periksa konfigurasi Google Sheet Anda.', 'error');
                return;
            }

            // Sembunyikan pesan yang mungkin muncul sebelumnya
            hideMessage();

            currentQuestionIndex = 0;
            score = 0;

            // Mengganti tampilan layar
            startScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');

            displayQuestion();
        }

        /**
         * Menampilkan pertanyaan dan opsi jawaban saat ini.
         * Opsi jawaban diambil dari kolom 'a', 'b', 'c', 'd' di Google Sheet.
         */
        function displayQuestion() {
            // Bersihkan opsi jawaban sebelumnya dan sembunyikan penjelasan
            optionsContainer.innerHTML = '';
            explanationBox.classList.add('hidden');
            explanationText.innerText = '';

            // Perbarui teks skor dan progres
            scoreText.innerText = `Skor: ${score}`;
            progressText.innerText = `Soal ${currentQuestionIndex + 1} dari ${allQuestions.length}`;

            const question = allQuestions[currentQuestionIndex];
            // Pengecekan keamanan tambahan jika soal tidak terdefinisi (seharusnya tidak terjadi setelah filter)
            if (!question) {
                console.error("Mencoba menampilkan soal yang tidak ada pada indeks:", currentQuestionIndex);
                showResults(); // Langsung tampilkan hasil jika ada masalah
                return;
            }
            questionText.innerText = question.soal; // Menampilkan teks pertanyaan

            // Iterasi melalui opsi 'a', 'b', 'c', 'd' untuk membuat tombol
            const options = ['a', 'b', 'c', 'd'];
            options.forEach(optionKey => {
                // Pastikan opsi tidak kosong sebelum membuat tombol
                if (question[optionKey] && question[optionKey].trim() !== '') {
                    const button = document.createElement('button');
                    button.innerText = question[optionKey]; // Teks tombol adalah isi opsi
                    button.classList.add(
                        'option-btn', 'w-full', 'p-4', 'bg-white', 'border-2',
                        'border-gray-200', 'rounded-lg', 'text-left', 'hover:bg-blue-50',
                        'hover:border-blue-300', 'focus:outline-none', 'focus:ring-2',
                        'focus:ring-blue-400'
                    );
                    button.dataset.option = optionKey; // Menyimpan kunci opsi (a, b, c, d) sebagai data atribut
                    button.addEventListener('click', selectAnswer); // Menambahkan event listener
                    optionsContainer.appendChild(button); // Menambahkan tombol ke container
                }
            });
        }

        /**
         * Dipanggil ketika pengguna memilih salah satu jawaban.
         * Memeriksa jawaban, memberikan feedback visual, dan melanjutkan ke pertanyaan berikutnya.
         */
        function selectAnswer(e) {
            const selectedButton = e.target;
            const selectedOption = selectedButton.dataset.option; // Opsi yang dipilih pengguna
            // Kunci jawaban dari Google Sheet, dinormalisasi (lowercase dan trim)
            const question = allQuestions[currentQuestionIndex];
            const correctOption = question.kunci.toLowerCase().trim();

            // Nonaktifkan semua tombol opsi setelah jawaban dipilih untuk mencegah klik ganda
            const allOptionButtons = optionsContainer.querySelectorAll('.option-btn');
            allOptionButtons.forEach(btn => btn.disabled = true);

            // Berikan feedback visual berdasarkan jawaban
            if (selectedOption === correctOption) {
                score += POINTS_PER_QUESTION; // Tambah skor berdasarkan poin per soal
                selectedButton.classList.add('correct'); // Beri warna hijau
            } else {
                selectedButton.classList.add('incorrect'); // Beri warna merah
                // Tunjukkan jawaban yang benar dengan memberi warna hijau pada tombol yang benar
                allOptionButtons.forEach(btn => {
                    if (btn.dataset.option === correctOption) {
                        btn.classList.add('correct');
                    }
                });
            }

            // Tampilkan penjelasan jika ada
            if (question.penjelasan && question.penjelasan.trim() !== '') {
                explanationText.innerText = question.penjelasan;
                explanationBox.classList.remove('hidden');
            }

            // Lanjut ke pertanyaan berikutnya atau tampilkan hasil setelah jeda singkat
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < allQuestions.length) {
                    displayQuestion(); // Tampilkan soal berikutnya
                } else {
                    showResults(); // Kuis selesai, tampilkan hasil
                }
            }, 3000); // Jeda 3 detik agar pengguna bisa membaca penjelasan
        }

        /**
         * Menampilkan layar hasil akhir kuis.
         * Menghitung dan menampilkan skor akhir dan ringkasan.
         */
        function showResults() {
            quizScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');

            // Tampilkan skor akhir dalam poin
            finalScore.innerText = `${score} Poin`;
            const correctAnswersCount = score / POINTS_PER_QUESTION;
            scoreSummary.innerText = `Anda menjawab ${correctAnswersCount} dari ${allQuestions.length} soal dengan benar!`;
            
            // Tampilkan nama, NIP, dan Satker di hasil akhir
            finalUserInfo.innerText = `Nama: ${userName} | NIP: ${userNip} | Satker: ${userSatker}`;

            // Logika untuk pesan hasil
            resultMessageBox.classList.remove('success-message', 'fail-message');
            resultEmoji.innerText = '';
            trophyIcon.classList.add('hidden');

            if (score >= PASSING_SCORE) {
                resultMessageBox.classList.add('success-message');
                resultMessage.innerText = "Selamat! Anda lulus dan berhak mendapatkan sertifikat ST9CU bulan Juli 2025!";
                resultEmoji.innerText = ""; // Emoji kegirangan
                trophyIcon.classList.remove('hidden'); // Tampilkan ikon piala
            } else {
                resultMessageBox.classList.add('fail-message');
                resultMessage.innerText = "Semangat! Ayo ikuti ST9CU bulan depan, semoga mendapatkan hasil lebih baik.";
                resultEmoji.innerText = ""; // Emoji semangat
            }

            // Tambahkan pengguna ke daftar yang sudah menyelesaikan kuis dan nonaktifkan tombol restart
            const normalizedUserName = normalizeString(userName);
            const normalizedUserNip = normalizeString(userNip);
            const userIdentifierForCompletion = `${normalizedUserName}-${normalizedUserNip}`;
            completedUsers.add(userIdentifierForCompletion);
            restartBtn.disabled = true;
            restartBtn.classList.add('btn-disabled');
        }

        // --- Event Listeners ---
        // Tombol "Mulai Kuis" pada layar awal
        startBtn.addEventListener('click', startQuiz);
        // Tombol "Ulangi Kuis" pada layar hasil
        // restartBtn.addEventListener('click', startQuiz); // Dinonaktifkan karena tombol akan dinonaktifkan setelah kuis selesai

        // --- Inisialisasi Aplikasi ---
        // Memuat data kuis saat DOM selesai dimuat
        document.addEventListener('DOMContentLoaded', loadQuizData);

    </script>

</body>
</html>
